# Set up the database
odin.sql.file (module.path.join ../Schema/core/000-initial.blue.sql)
odin.sql.file (module.path.join ../Schema/opts/full-name/001-initial.blue.sql)
odin.sql.file (module.path.join ../Schema/opts/email/001-initial.blue.sql)
odin.sql.file (module.path.join ../Schema/opts/google/001-initial.blue.sql)

set gg (odin.google.get_user_detail eyJhbGciOiJSUzI1NiIsImtpZCI6IjhjOWViOTY4ZjczNzQ0ZWFlZDQyMWU0ODAxMDE0MmJjZTUxYTA2N2YifQ.eyJhenAiOiIxMDcxNDE5NDE3NzI3LTFhc2tnYXFoYXZoMDllbmY1anBsbDVlZ2Vqazg1NWdyLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tIiwiYXVkIjoiMTA3MTQxOTQxNzcyNy0xYXNrZ2FxaGF2aDA5ZW5mNWpwbGw1ZWdlams4NTVnci5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSIsInN1YiI6IjEwMTgyMTU1OTcwODM3NjIyOTI5NiIsImhkIjoicHJvdGV1cy10ZWNoLmNvbSIsImVtYWlsIjoicHVtaWRvbkBwcm90ZXVzLXRlY2guY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsImF0X2hhc2giOiJMazQ4djRXN05kcVVtNDlkWGNGNnFnIiwiZXhwIjoxNTMxOTE1MDk5LCJpc3MiOiJhY2NvdW50cy5nb29nbGUuY29tIiwianRpIjoiOTRiN2NiY2RmZDIxYzU1MTFmM2VlZmViNDUxMzNmOWI2Nzk2Mjc3YiIsImlhdCI6MTUzMTkxMTQ5OSwibmFtZSI6IlB1bWlkb24gUGhhdGhvbmciLCJwaWN0dXJlIjoiaHR0cHM6Ly9saDMuZ29vZ2xldXNlcmNvbnRlbnQuY29tLy01TGdQanZ3RGtWTS9BQUFBQUFBQUFBSS9BQUFBQUFBQUFBQS9BQW5uWTdxTTNMT0RBc2ZrY1lFVmRfRUMzU0xjRzVVTkRnL3M5Ni1jL3Bob3RvLmpwZyIsImdpdmVuX25hbWUiOiJQdW1pZG9uIiwiZmFtaWx5X25hbWUiOiJQaGF0aG9uZyIsImxvY2FsZSI6ImVuIn0.n1PX7M1iz5YHrONl7yTtB79Ha3MPX23vFa9WUCxRxQ0axVdsot5qrNBFNvZoL1vlI6yrirdVkqXUNWPhYBMczCkYnRanx_0qRLekzxkVGI77anrtXECAspXDUNZ6x_XoC31GtGzyUzN9v_CJn8mK_PuNKzLlYl-qq9_jIYjbUbJabuPgg4tVnatZZ62Cm8vIsi2fjPzwJ8Jm6yKGesNEDKInF5H0xcV_Q5e4MM4VvafxsyWvqNgaQ9LZPflXq2WAdqeFA9Kk_kWVd4Cm-LkY6amvsWVHdN8tNuISlupf0c-szbJs4ju583pjm__U9Hge3uZnFHEY01FajPdAbo0yUg)
contains (lookup gg) {"name": "tle"}

# GET odin/test/google/login/ok / 300

# POST odin/test/google/login/ok / {} 501
# POST odin/test/google/login/ok / {"access_token": ""} 200


# GET odin/test/google/validate_login /count-users 200 {"count": 0}
# GET odin/test/google/validate_login /count-google-users 200 {"count": 0}

# POST odin/test/google/login/ok / {"access_token": "user_1"} 200
# POST odin/test/google/login/error / {"access_token": "WRONG_ACCESS_TOKEN"} 501

# GET odin/test/google/validate_login /count-users 200 {"count": 1}
# GET odin/test/google/validate_login /count-google-users 200 {"count": 1}

# Login with the same google user id should not create new identity
# POST odin/test/google/login/ok / {"access_token": "user_1"} 200
# GET odin/test/google/validate_login /count-users 200 {"count": 1}
# GET odin/test/google/validate_login /count-google-users 200 {"count": 1}


# POST odin/test/google/login/ok / {"access_token": "user_2"} 200
# GET odin/test/google/validate_login /count-users 200 {"count": 2}
# GET odin/test/google/validate_login /count-google-users 200 {"count": 2}

